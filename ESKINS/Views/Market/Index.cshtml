@model List<ESKINS.DbServices.Models.ItemsModels>
@{
    ViewData["Title"] = "Market";
}
@section head{
	<link href="~/css/market2.css" type="text/css" rel="stylesheet" />
	<link href="~/css/style.css" type="text/css" rel="stylesheet" />
	<link href="~/css/card.css" type="text/css" rel="stylesheet" />
}
<style>

	.button-27 {
		margin: 6px;
		appearance: none;
		background-color: #101010;
		border: 2px solid #1A1A1A;
		border-radius: 15px;
		box-sizing: border-box;
		color: #FFFFFF;
		cursor: pointer;
		display: inline-block;
		font-family: Roobert,-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";
		font-size: 16px;
		font-weight: 600;
		line-height: normal;
		margin: 0;
		min-height: 40px;
		min-width: 0;
		outline: none;
		padding: 16px 24px;
		text-align: center;
		text-decoration: none;
		transition: all 300ms cubic-bezier(.23, 1, 0.32, 1);
		user-select: none;
		-webkit-user-select: none;
		touch-action: manipulation;
		width: 100%;
		will-change: transform;
	}

		.button-27:disabled {
			pointer-events: none;
		}

		.button-27:hover {
			box-shadow: rgba(0, 0, 0, 0.25) 0 8px 15px;
			transform: translateY(-2px);
		}

		.button-27:active {
			box-shadow: none;
			transform: translateY(0);
		}

	.showDetails {
		margin-left: -30px;
		margin-top: -90px;
	}

</style>
<div class="filtering" style="height:auto;">
	<div class="box1" style="text-align:center;">
		<ul style="display: flex; justify-content: center; align-items: center; list-style-type: none;">
			<li>
				<button class="button-27" id="refresh" onclick="location.href='@Url.Action("Index", "Market")'"><span class="glyphicon glyphicon-refresh"></span> Refresh</button>
			</li>
			<li>
				<button class="button-27" id="discount" ><span class="bi bi-percent"></span> Best Discount</button>
			</li>
			<li>
				<button class="button-27" id="newest" ><span class="bi bi-arrow-down"></span> Newest First</button>
			</li>
			<li>
				<button class="button-27" id="oldest" ><span class="bi bi-arrow-up"></span> Oldest First</button>
			</li>
			<li>
				<button class="button-27" id="lowest" ><span class="bi bi-caret-down-fill"></span> Lowest First</button>
			</li>
			<li>
				<button class="button-27" id="highest"><span class="bi bi-caret-up-fill"></span> Highest First</button>
			</li>
		</ul>
	</div>
</div> 

@*<button class="button-20" style="margin-left:-30px;margin-top:-90px;" id="myModalBtn"><i class="bi bi-info-circle"></i></button>*@
<div id="myModalContainer"></div>
<main class="cd-main-content">
	<div style="margin-left: 100px;">
		<section class="cd-gallery">
			<div id="itemContainer">
				@Html.Partial("_ItemPartial", Model)
			</div>
		<div class="cd-fail-message">No results found</div>
		</section> <!-- cd-gallery -->
	</div>

	<div id="myModalContainer"></div>
	<div class="cd-filter" style="background-color:	#181716; color: #a9a9a9;">
		<form>
			<div class="cd-filter-block">
				<h4>Search</h4>

				<div class="cd-filter-content" style="display:none;">
					<input type="search" id="searchInput" placeholder="Search Any Skin Here..." oninput="searchItems()">
				</div> <!-- cd-filter-content -->
			</div> <!-- cd-filter-block -->
			@await Component.InvokeAsync("CategoriesComponent")
			@await Component.InvokeAsync("ItemLocationComponent")
			@await Component.InvokeAsync("CollectionsComponent")
			@await Component.InvokeAsync("UniqueItemsComponent")
			@await Component.InvokeAsync("PhasesComponent")
		</form>
		<a href="#0" class="cd-close" style="color: #a9a9a9;text-decoration:none;">Close</a>
	</div> 
	<a href="#0" class="cd-filter-trigger" style="text-decoration:none;">Filters</a>
</main> <!-- cd-main-content -->

<script>
	// radio buttons
	$(document).ready(function () {
		$('input[type="radio"]').change(function () {
			var selectedValue = $(this).attr('id'); // Get the selected value
			// Send a POST request to the controller
			$.ajax({
				url: '@Url.Action("SearchCollection", "Market")',
				type: 'POST',
				data: { checkedCollection: selectedValue },
				success: function (response) {
					// Handle the response from the server
					$('#itemContainer').html(response);
				},
				error: function (xhr, status, error) {
					// Handle the error
					alert('An error occurred while searching for items.');
				}
			});
		});
	});
	// filter select.
	$(document).ready(function () {
		$('#selectThis').change(function () {
			var selectedValue = $(this).val(); // Get the selected value
			// Disable other radio buttons in the group
			$('input[type="radio"]').not(':checked').prop('disabled', true);
			// Iterate over each option in the select element
			$('#selectThis option').each(function () {
				if ($(this).val() === selectedValue) {
					// Send AJAX request to the server
					$.ajax({
						url: '@Url.Action("SearchLocation", "Market")',
						type: 'POST',
						data: { checkedLocation: selectedValue },
						success: function (response) {
							// Handle the response from the server
							// Update the UI with the filtered items
							$('#itemContainer').html(response);
						},
						error: function (xhr, status, error) {
							// Handle the error
							alert('An error occurred while searching for items.');
						}
					});
				} else {
				}
			});
		});
	});
	//Unigue items checkboxes
	$(document).ready(function () {
		// Attach event listener to the category checkboxes
		$('.unique-checkbox').change(function () {
			// Get the checked checkboxes
			var checkedCategories = $('.unique-checkbox:checked').map(function () {
				return $(this).val();
			}).get();

			// Send AJAX request to the server
			$.ajax({
				url: '@Url.Action("SearchUnique", "Market")',
				type: 'POST',
				data: { categories: checkedCategories },
				success: function (response) {
					// Handle the response from the server
					// Update the UI with the filtered items
					$('#itemContainer').html(response);
				},
				error: function (xhr, status, error) {
					// Handle the error
					alert('An error occurred while searching for items.');
				}
			});
		});
	});
	//phase checkboxes
	$(document).ready(function () {
		// Attach event listener to the category checkboxes
		$('.phase-checkbox').change(function () {
			// Get the checked checkboxes
			var checkedCategories = $('.phase-checkbox:checked').map(function () {
				return $(this).val();
			}).get();

			// Send AJAX request to the server
			$.ajax({
				url: '@Url.Action("SearchPhases", "Market")',
				type: 'POST',
				data: { categories: checkedCategories },
				success: function (response) {
					// Handle the response from the server
					// Update the UI with the filtered items
					$('#itemContainer').html(response);
				},
				error: function (xhr, status, error) {
					// Handle the error
					alert('An error occurred while searching for items.');
				}
			});
		});
	});
	//categories checkboxes
	$(document).ready(function () {
		// Attach event listener to the category checkboxes
		$('.category-checkbox').change(function () {
			// Get the checked checkboxes
			var checkedCategories = $('.category-checkbox:checked').map(function () {
				return $(this).val();
			}).get();

			// Send AJAX request to the server
			$.ajax({
				url: '@Url.Action("SearchCategories", "Market")',
				type: 'POST',
				data: { categories: checkedCategories },
				success: function (response) {
					// Handle the response from the server
					// Update the UI with the filtered items
					$('#itemContainer').html(response);
				},
				error: function (xhr, status, error) {
					// Handle the error
					alert('An error occurred while searching for items.');
				}
			});
		});
	});
	// search items function
	var searchTimeout; // Variable to store the timeout

	function searchItems() {
		clearTimeout(searchTimeout); // Clear any existing timeout

		searchTimeout = setTimeout(function () {
			var searchQuery = document.getElementById('searchInput').value;

			// Make an AJAX call to search for items
			$.ajax({
				url: '@Url.Action("SearchItems", "Market")',
				type: 'POST',
				data: { query: searchQuery },
				success: function (data) {
					// Update the item container with the search results
					$('#itemContainer').html(data);
				},
				error: function () {
					alert('An error occurred while searching for items.');
				}
			});
		}, 500); // Delay the search by 500 milliseconds (adjust as needed)
	}

	//Button click event listener
	document.getElementById("highest").addEventListener("click", function () {
		filterItems();
	});

	// AJAX call to filter items
	function filterItems() {
		$.ajax({
			url: '@Url.Action("HighestPrice", "Market")',
			type: 'GET',
			success: function (data) {
				// Update the item container with the filtered items
				$('#itemContainer').html(data);
			},
			error: function () {
				alert('An error occurred while filtering items.');
			}
		});
	}

	document.getElementById("lowest").addEventListener("click", function () {
		filterLowest();
	});

	// AJAX call to filter items
	function filterLowest() {
		$.ajax({
			url: '@Url.Action("LowestPrice", "Market")',
			type: 'GET',
			success: function (data) {
				// Update the item container with the filtered items
				$('#itemContainer').html(data);
			},
			error: function () {
				alert('An error occurred while filtering items.');
			}
		});
	}

	document.getElementById("oldest").addEventListener("click", function () {
		filterOldest();
	});

	// AJAX call to filter items
	function filterOldest() {
		$.ajax({
			url: '@Url.Action("Oldest", "Market")',
			type: 'GET',
			success: function (data) {
				// Update the item container with the filtered items
				$('#itemContainer').html(data);
			},
			error: function () {
				alert('An error occurred while filtering items.');
			}
		});
	}

	document.getElementById("newest").addEventListener("click", function () {
		filterNewest();
	});

	// AJAX call to filter items
	function filterNewest() {
		$.ajax({
			url: '@Url.Action("Newest", "Market")',
			type: 'GET',
			success: function (data) {
				// Update the item container with the filtered items
				$('#itemContainer').html(data);
			},
			error: function () {
				alert('An error occurred while filtering items.');
			}
		});
	}

	document.getElementById("discount").addEventListener("click", function () {
		filterDiscount();
	});

	// AJAX call to filter items
	function filterDiscount() {
		$.ajax({
			url: '@Url.Action("BestDeals", "Market")',
			type: 'GET',
			success: function (data) {
				// Update the item container with the filtered items
				$('#itemContainer').html(data);
			},
			error: function () {
				alert('An error occurred while filtering items.');
			}
		});
	}

</script>
<style>
	
	/* --------------------------------

	Primary style

	-------------------------------- */
	*, *::after, *::before {
		-webkit-box-sizing: border-box;
		-moz-box-sizing: border-box;
		box-sizing: border-box;
	}

	html {
		font-size: 62.5%;
	}

		html * {
			-webkit-font-smoothing: antialiased;
			-moz-osx-font-smoothing: grayscale;
		}

	body {
		font-size: 1.6rem;
		font-family: "Open Sans", sans-serif;
		color: #331d35;
		background-color: #e7e7e7;
	}

	a {
		color: #41307c;
		text-decoration: none;
	}

	/* --------------------------------

	Main Components

	-------------------------------- */
	.cd-header {
		position: relative;
		height: 150px;
		background-color: #331d35;
	}

		.cd-header h1 {
			color: #ffffff;
			line-height: 150px;
			text-align: center;
			font-size: 2.4rem;
			font-weight: 300;
		}

	@@media only screen and (min-width: 1170px) {
		.cd-header {
			height: 180px;
		}

			.cd-header h1 {
				line-height: 180px;
			}
	}

	.cd-main-content {
		position: relative;
		min-height: 100vh;
	}

		.cd-main-content:after {
			content: "";
			display: table;
			clear: both;
		}

		.cd-main-content.is-fixed .cd-tab-filter-wrapper {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
		}

		.cd-main-content.is-fixed .cd-gallery {
			padding-top: 76px;
		}

		.cd-main-content.is-fixed .cd-filter {
			position: fixed;
			height: 100vh;
			overflow: hidden;
		}

			.cd-main-content.is-fixed .cd-filter form {
				height: 100vh;
				overflow: auto;
				-webkit-overflow-scrolling: touch;
			}

		.cd-main-content.is-fixed .cd-filter-trigger {
			position: fixed;
		}

	@@media only screen and (min-width: 768px) {
		.cd-main-content.is-fixed .cd-gallery {
			padding-top: 90px;
		}
	}

	@@media only screen and (min-width: 1170px) {
		.cd-main-content.is-fixed .cd-gallery {
			padding-top: 100px;
		}
	}

	/* --------------------------------

	xtab-filter

	-------------------------------- */
	.cd-tab-filter-wrapper {
		background-color: #ffffff;
		box-shadow: 0 1px 1px rgba(0, 0, 0, 0.08);
		z-index: 1;
	}

		.cd-tab-filter-wrapper:after {
			content: "";
			display: table;
			clear: both;
		}

	.cd-tab-filter {
		position: relative;
		height: 50px;
		width: 140px;
		margin: 0 auto;
		z-index: 1;
	}

		.cd-tab-filter::after {
			content: '';
			position: absolute;
			right: 14px;
			top: 50%;
			bottom: auto;
			-webkit-transform: translateY(-50%);
			-moz-transform: translateY(-50%);
			-ms-transform: translateY(-50%);
			-o-transform: translateY(-50%);
			transform: translateY(-50%);
			display: inline-block;
			width: 16px;
			height: 16px;
			background: url('../img/cd-icon-arrow.svg') no-repeat center center;
			-webkit-transition: all 0.3s;
			-moz-transition: all 0.3s;
			transition: all 0.3s;
			pointer-events: none;
		}

		.cd-tab-filter ul {
			position: absolute;
			top: 0;
			left: 0;
			background-color: #ffffff;
			box-shadow: inset 0 -2px 0 #41307c;
		}

		.cd-tab-filter li {
			display: none;
		}

			.cd-tab-filter li:first-child {
				display: block;
			}

		.cd-tab-filter a {
			display: block;
			height: 50px;
			width: 140px;
			line-height: 50px;
			padding-left: 14px;
		}

			.cd-tab-filter a.selected {
				background: #41307c;
				color: #ffffff;
			}

		.cd-tab-filter.is-open::after {
			-webkit-transform: translateY(-50%) rotate(-180deg);
			-moz-transform: translateY(-50%) rotate(-180deg);
			-ms-transform: translateY(-50%) rotate(-180deg);
			-o-transform: translateY(-50%) rotate(-180deg);
			transform: translateY(-50%) rotate(-180deg);
		}

		.cd-tab-filter.is-open ul {
			box-shadow: inset 0 -2px 0 #41307c, 0 2px 10px rgba(0, 0, 0, 0.2);
		}

			.cd-tab-filter.is-open ul li {
				display: block;
			}

		.cd-tab-filter.is-open .placeholder a {
			opacity: .4;
		}

	@@media only screen and (min-width: 768px) {
		.cd-tab-filter {
			width: auto;
			cursor: auto;
		}

			.cd-tab-filter::after {
				display: none;
			}

			.cd-tab-filter ul {
				background: transparent;
				position: static;
				box-shadow: none;
				text-align: center;
			}

			.cd-tab-filter li {
				display: inline-block;
			}

				.cd-tab-filter li.placeholder {
					display: none !important;
				}

			.cd-tab-filter a {
				display: inline-block;
				padding: 0 1em;
				width: auto;
				color: #9a9a9a;
				text-transform: uppercase;
				font-weight: 700;
				font-size: 1.3rem;
			}

		.no-touch .cd-tab-filter a:hover {
			color: #41307c;
		}

		.cd-tab-filter a.selected {
			background: transparent;
			color: #41307c;
			box-shadow: inset 0 -2px 0 #41307c;
		}

		.cd-tab-filter.is-open ul li {
			display: inline-block;
		}
	}

	@@media only screen and (min-width: 1170px) {
		.cd-tab-filter {
			width: 100%;
			float: right;
			margin: 0;
			-webkit-transition: width 0.3s;
			-moz-transition: width 0.3s;
			transition: width 0.3s;
		}

			.cd-tab-filter.filter-is-visible {
				width: 80%;
			}
	}

	.cd-gallery {
		padding: 26px 5%;
		width: 100%;
	}

		.cd-gallery li {
			margin-bottom: 1.6em;
			box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
			display: none;
		}

			.cd-gallery li.gap {
				opacity: 0;
				height: 0;
				display: inline-block;
			}

		.cd-gallery img {
			display: block;
			width: 100%;
		}

		.cd-gallery .cd-fail-message {
			display: none;
			text-align: center;
		}

	@@media only screen and (min-width: 768px) {
		.cd-gallery {
			padding: 40px 3%;
		}

			.cd-gallery ul {
				text-align: justify;
			}

				.cd-gallery ul:after {
					content: "";
					display: table;
					clear: both;
				}

			.cd-gallery li {
				width: 48%;
				margin-bottom: 2em;
			}
	}

	@@media only screen and (min-width: 1170px) {
		.cd-gallery {
			padding: 50px 2%;
			float: right;
			-webkit-transition: width 0.3s;
			-moz-transition: width 0.3s;
			transition: width 0.3s;
		}

			.cd-gallery li {
				width: 23%;
			}

			.cd-gallery.filter-is-visible {
				width: 80%;
			}
	}

	.cd-filter {
		position: absolute;
		top: 0;
		left: 0;
		width: 280px;
		height: 100%;
		background: #ffffff;
		box-shadow: 4px 4px 20px transparent;
		z-index: 2;
		-webkit-transform: translateZ(0);
		-moz-transform: translateZ(0);
		-ms-transform: translateZ(0);
		-o-transform: translateZ(0);
		transform: translateZ(0);
		-webkit-backface-visibility: hidden;
		backface-visibility: hidden;
		-webkit-transform: translateX(-100%);
		-moz-transform: translateX(-100%);
		-ms-transform: translateX(-100%);
		-o-transform: translateX(-100%);
		transform: translateX(-100%);
		-webkit-transition: -webkit-transform 0.3s, box-shadow 0.3s;
		-moz-transition: -moz-transform 0.3s, box-shadow 0.3s;
		transition: transform 0.3s, box-shadow 0.3s;
	}

		.cd-filter::before {
			content: '';
			position: absolute;
			top: 0;
			left: 0;
			height: 50px;
			width: 100%;
			background-color: #41307c;
			z-index: 2;
		}

		.cd-filter form {
			padding: 70px 20px;
		}

		.cd-filter .cd-close {
			position: absolute;
			top: 0;
			right: 0;
			height: 50px;
			line-height: 50px;
			width: 60px;
			color: #ffffff;
			font-size: 1.3rem;
			text-align: center;
			background: #37296a;
			opacity: 0;
			-webkit-transition: opacity 0.3s;
			-moz-transition: opacity 0.3s;
			transition: opacity 0.3s;
			z-index: 3;
		}

	.no-touch .cd-filter .cd-close:hover {
		background: #32255f;
	}

	.cd-filter.filter-is-visible {
		-webkit-transform: translateX(0);
		-moz-transform: translateX(0);
		-ms-transform: translateX(0);
		-o-transform: translateX(0);
		transform: translateX(0);
		box-shadow: 4px 4px 20px rgba(0, 0, 0, 0.2);
	}

		.cd-filter.filter-is-visible .cd-close {
			opacity: 1;
		}

	@@media only screen and (min-width: 1170px) {
		.cd-filter {
			width: 20%;
		}

		.cd-filter form {
			padding: 70px 10%;
		}
	}

	.cd-filter-trigger {
		position: absolute;
		top: 0;
		left: 0;
		height: 50px;
		line-height: 50px;
		width: 60px;
		overflow: hidden;
		text-indent: 100%;
		color: transparent;
		white-space: nowrap;
		background: transparent url("../img/cd-icon-filter.svg") no-repeat center center;
		z-index: 3;
	}

		.cd-filter-trigger.filter-is-visible {
			pointer-events: none;
		}

	@@media only screen and (min-width: 1170px) {
		.cd-filter-trigger {
			width: auto;
			left: 2%;
			text-indent: 0;
			color: #9a9a9a;
			text-transform: uppercase;
			font-size: 1.3rem;
			font-weight: 700;
			padding-left: 24px;
			background-position: left center;
			-webkit-transition: color 0.3s;
			-moz-transition: color 0.3s;
			transition: color 0.3s;
		}

		.no-touch .cd-filter-trigger:hover {
			color: #41307c;
		}

		.cd-filter-trigger.filter-is-visible, .cd-filter-trigger.filter-is-visible:hover {
			color: #ffffff;
		}
	}
</style>