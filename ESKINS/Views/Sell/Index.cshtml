@model List<ESKINS.DbServices.Models.ItemsModels>
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    Layout = "_MainPageLayout";
}
@section head{
	<link href="~/css/market2.css" type="text/css" rel="stylesheet" />
	<link href="~/css/sell.css" type="text/css" rel="stylesheet" />
	<link href="~/css/card.css" type="text/css" rel="stylesheet" />
}

<script>
	$(document).ready(function () {
		$("#cardMove").click(function () {
			$(".card").appendTo("#itemsSellForSale");
			$(this).hide(); // Hide move button
		});
	});
</script>
<main class="cd-main-content">
	<div style="margin-left: 100px; margin-top:-10px;">
		<section class="cd-gallery" style="margin-top: -20px;">
			<div style="margin-top:-45px;">
				<h2 style="color:white;"><strong>Inventory:</strong></h2>
				<div id="itemContainer">
					@Html.Partial("_ItemPartial", Model)
				</div>
				<div class="cd-fail-message">No results found</div>
					@await Component.InvokeAsync("SaleCartComponent")
				<br />
				<div class="itemsSell">
					<div class="itemsSellForSale" id="itemsSellForSale" style="height: 220px;">
					</div>
					<div class="itemsSellButtons">
						<form method="post" asp-action="InstantSale">
							<button name="instantSaleBtn">Instant Sale</button>
						</form>
						<form method="post" asp-action="RemoveFromCart">
							<button name="removeFromCartBtn">Remove From Cart</button>
						</form>
					</div>
				</div>
			</div>
		</section> <!-- cd-gallery -->
	</div>
	<div class="cd-filter" style="background-color:	#181716; color: #a9a9a9;">
		<form>
	<div class="cd-filter-block">
		<h4>Search</h4>
		<div class="cd-filter-content" style="display:none;">
			<input type="search" id="searchInput" placeholder="Search Any Skin Here..." oninput="searchItems()">
		</div> <!-- cd-filter-content -->
		</div> <!-- cd-filter-block -->
			@await Component.InvokeAsync("CategoriesComponent")
			@await Component.InvokeAsync("ItemLocationComponent")
			@await Component.InvokeAsync("CollectionsComponent")
			@await Component.InvokeAsync("UniqueItemsComponent")
			@await Component.InvokeAsync("PhasesComponent")
			</form>
			<a href="#0" class="cd-close" style="color: #a9a9a9; text-decoration: none;">Close</a>
		</div>
	<a href="#0" class="cd-filter-trigger" style="text-decoration: none;">Filters</a>
	
</main> <!-- cd-main-content -->
<script>
	function moveToSaleCart(button) {
		var card = button.parentNode.parentNode;
		var hiddenInput = card.querySelector('input[name="id"]');
		var saleCartDiv = document.getElementById("itemsSellForSale");

		// Clone the card
		var clonedCard = card.cloneNode(true);

		// Remove the button from the cloned card
		var clonedButton = clonedCard.querySelector('.button-20');
		clonedButton.parentNode.removeChild(clonedButton);

		// Append the cloned card to the saleCartDiv
		saleCartDiv.appendChild(clonedCard);

		// Remove the original card from the DOM
		card.parentNode.removeChild(card);

		// Optional: Update the hidden input's name to avoid duplicate names
		hiddenInput.setAttribute('name', 'saleItemId');
	}
</script>
<script>
	function sendItemToInstantSale(id) {
		// Make an AJAX request to the server
		$.ajax({
			type: 'POST',
			url: '@Url.Action("AddForSale", "Sell")',
			data: { id: id },
			success: function (response) {
				// Handle the successful response
				$('#itemsSellForSale').html(response);
			},
			error: function () {
				// Handle the error
				alert('An error occurred during the AJAX request.');
			}
		});
	}
	function sendItemDetails(itemId) {
		// Make an AJAX request to the server
		$.ajax({
			type: "POST",
			url: '@Url.Action("RemoveFromSale", "Sell")',
			data: { itemId: itemId },
			success: function (response) {
				$('#itemContainer').html(response);
			},
			error: function () {
				alert("An error occurred during the AJAX request.");
			}
		});
	}
	// radio buttons
	$(document).ready(function () {
		$('input[type="radio"]').change(function () {
			var selectedValue = $(this).attr('id'); // Get the selected value
			// Send a POST request to the controller
			$.ajax({
				url: '@Url.Action("SearchCollection", "Sell")',
				type: 'POST',
				data: { checkedCollection: selectedValue },
				success: function (response) {
					// Handle the response from the server
					$('#itemContainer').html(response);
				},
				error: function (xhr, status, error) {
					// Handle the error
					alert('An error occurred while searching for items.');
				}
			});
		});
	});
	// filter select.
	$(document).ready(function () {
		$('#selectThis').change(function () {
			var selectedValue = $(this).val(); // Get the selected value

			// Iterate over each option in the select element
			$('#selectThis option').each(function () {
				if ($(this).val() === selectedValue) {
					// Send AJAX request to the server
					$.ajax({
						url: '@Url.Action("SearchLocation", "Sell")',
						type: 'POST',
						data: { checkedLocation: selectedValue },
						success: function (response) {
							// Handle the response from the server
							// Update the UI with the filtered items
							$('#itemContainer').html(response);
						},
						error: function (xhr, status, error) {
							// Handle the error
							alert('An error occurred while searching for items.');
						}
					});
				} else {
				}
			});
		});
	});
	// search items function
	var searchTimeout; // Variable to store the timeout

	function searchItems() {
		clearTimeout(searchTimeout); // Clear any existing timeout

		searchTimeout = setTimeout(function () {
			var searchQuery = document.getElementById('searchInput').value;

			// Make an AJAX call to search for items
			$.ajax({
				url: '@Url.Action("SearchItems", "Sell")',
				type: 'POST',
				data: { query: searchQuery },
				success: function (data) {
					// Update the item container with the search results
					$('#itemContainer').html(data);
				},
				error: function () {
					alert('An error occurred while searching for items.');
				}
			});
		}, 500); // Delay the search by 500 milliseconds (adjust as needed)
	}

	//Unigue items checkboxes
	$(document).ready(function () {
		// Attach event listener to the category checkboxes
		$('.unique-checkbox').change(function () {
			// Get the checked checkboxes
			var checkedCategories = $('.unique-checkbox:checked').map(function () {
				return $(this).val();
			}).get();

			// Send AJAX request to the server
			$.ajax({
				url: '@Url.Action("SearchUnique", "Sell")',
				type: 'POST',
				data: { categories: checkedCategories },
				success: function (response) {
					// Handle the response from the server
					// Update the UI with the filtered items
					$('#itemContainer').html(response);
				},
				error: function (xhr, status, error) {
					// Handle the error
					alert('An error occurred while searching for items.');
				}
			});
		});
	});
	//phase checkboxes
	$(document).ready(function () {
		// Attach event listener to the category checkboxes
		$('.phase-checkbox').change(function () {
			// Get the checked checkboxes
			var checkedCategories = $('.phase-checkbox:checked').map(function () {
				return $(this).val();
			}).get();

			// Send AJAX request to the server
			$.ajax({
				url: '@Url.Action("SearchPhases", "Sell")',
				type: 'POST',
				data: { categories: checkedCategories },
				success: function (response) {
					// Handle the response from the server
					// Update the UI with the filtered items
					$('#itemContainer').html(response);
				},
				error: function (xhr, status, error) {
					// Handle the error
					alert('An error occurred while searching for items.');
				}
			});
		});
	});
	//categories checkboxes
	$(document).ready(function () {
		// Attach event listener to the category checkboxes
		$('.category-checkbox').change(function () {
			// Get the checked checkboxes
			var checkedCategories = $('.category-checkbox:checked').map(function () {
				return $(this).val();
			}).get();

			// Send AJAX request to the server
			$.ajax({
				url: '@Url.Action("SearchCategories", "Sell")',
				type: 'POST',
				data: { categories: checkedCategories },
				success: function (response) {
					// Handle the response from the server
					// Update the UI with the filtered items
					$('#itemContainer').html(response);
				},
				error: function (xhr, status, error) {
					// Handle the error
					alert('An error occurred while searching for items.');
				}
			});
		});
	});

</script>
